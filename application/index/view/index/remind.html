{include file='index/header' /}
<style>
    .remind-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .remind-tabs {
        display: flex;
        flex-wrap: wrap;
        border-bottom: 1px solid #eee;
        margin-bottom: 20px;
    }
    
    .remind-tab {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        margin-right: 5px;
        margin-bottom: 5px;
        border-radius: 4px;
        display: flex;
        align-items: center;
    }
    
    .remind-tab.active {
        border-bottom: 3px solid #1E9FFF;
        color: #1E9FFF;
        background: #f0f8ff;
    }

    .remind-tab-count {
        background: #ff6b6b;
        color: white;
        border-radius: 10px;
        padding: 2px 6px;
        font-size: 12px;
        margin-left: 5px;
    }
    
    .remind-item {
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .remind-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .remind-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .remind-user {
        font-weight: bold;
        color: #333;
    }
    
    .remind-content {
        margin-left: 50px;
    }
    
    .remind-text {
        color: #666;
        margin-bottom: 10px;
        line-height: 1.5;
    }
    
    .remind-detail {
        background: #f9f9f9;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-size: 14px;
        color: #555;
    }
    
    .remind-time {
        font-size: 12px;
        color: #999;
        text-align: right;
    }
    
    .remind-actions {
        text-align: right;
        margin-top: 10px;
    }
    
    .remind-actions button {
        margin-left: 10px;
        padding: 5px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        cursor: pointer;
        font-size: 12px;
    }
    
    .remind-actions button:hover {
        background: #f5f5f5;
    }
    
    .remind-actions .read-btn {
        color: #1E9FFF;
    }
    
    .remind-actions .view-btn {
        color: #5FB878;
    }
    
    .no-data {
        text-align: center;
        color: #999;
        padding: 40px;
    }
    
    .loading {
        text-align: center;
        padding: 20px;
        color: #999;
    }
    
    .fade-out {
        opacity: 0;
        transition: opacity 0.3s ease;
    }
</style>

<div class="main">
    <div class="contents">
        <div class="remind-container">
            <h2>提醒</h2>
            
            <div class="remind-tabs">
                <div class="remind-tab active" data-type="all">全部
                {if $unreadCount.unreadAllCount > 0}
                    <span class="remind-tab-count" id="count-all">{$unreadCount.unreadAllCount}</span>
                {/if}
                </div>
                <div class="remind-tab" data-type="1">评论
                {if isset($unreadCount.unreadTypeCount.1) && $unreadCount.unreadTypeCount.1 > 0}
                    <span class="remind-tab-count" id="count-1">{$unreadCount.unreadTypeCount.1}</span>
                {/if}
                </div>
                <div class="remind-tab" data-type="2">回复
                {if isset($unreadCount.unreadTypeCount.2) && $unreadCount.unreadTypeCount.2 > 0}
                    <span class="remind-tab-count" id="count-2">{$unreadCount.unreadTypeCount.2}</span>
                {/if}
                </div>
                <div class="remind-tab" data-type="3">频道评论
                {if isset($unreadCount.unreadTypeCount.3) && $unreadCount.unreadTypeCount.3 > 0}
                    <span class="remind-tab-count" id="count-3">{$unreadCount.unreadTypeCount.3}</span>
                {/if}
                </div>
                <div class="remind-tab" data-type="4">频道回复
                {if isset($unreadCount.unreadTypeCount.4) && $unreadCount.unreadTypeCount.4 > 0}
                    <span class="remind-tab-count" id="count-4">{$unreadCount.unreadTypeCount.4}</span>
                {/if}
                </div>
                <div class="remind-tab" data-type="5">关注
                {if isset($unreadCount.unreadTypeCount.5) && $unreadCount.unreadTypeCount.5 > 0}
                    <span class="remind-tab-count" id="count-5">{$unreadCount.unreadTypeCount.5}</span>
                {/if}
                </div>
                <div class="remind-tab" data-type="7">@提及
                {if isset($unreadCount.unreadTypeCount.7) && $unreadCount.unreadTypeCount.7 > 0}
                    <span class="remind-tab-count" id="count-7">{$unreadCount.unreadTypeCount.7}</span>
                {/if}
                </div>
                <div class="remind-tab" data-type="8">收藏
                {if isset($unreadCount.unreadTypeCount.8) && $unreadCount.unreadTypeCount.8 > 0}
                    <span class="remind-tab-count" id="count-8">{$unreadCount.unreadTypeCount.8}</span>
                {/if}
                </div>
            </div>
            
            <div id="remindList">
                <div class="loading">加载中...</div>
            </div>
            
            <div id="loadMore" style="text-align: center; padding: 20px; display: none;">
                <button onclick="loadMoreReminders()" class="layui-btn">加载更多</button>
            </div>
        </div>
    </div>
    <input type="hidden" id="loginUserInfo" value="{$loginUserInfo['blog']}">
    {if $userInfo.isSiteUser}
        {include file='index/sidebar_index' /}
    {else}
        {include file='index/sidebar_user' /}
    {/if}
</div>

{include file='index/footer' /}

<script>
let currentPage = 1;
let currentType = 'all';
let hasMore = true;

$(function() {
    loadReminders(currentType, 1);
    
    // 标签页切换
    $('.remind-tab').on('click', function() {
        const type = $(this).data('type');
        if (currentType !== type) {
            $('.remind-tab').removeClass('active');
            $(this).addClass('active');
            currentType = type;
            currentPage = 1;
            hasMore = true;
            $('#remindList').html('<div class="loading">加载中...</div>');
            loadReminders(type, 1);
        }
    });
});

function loadReminders(type, page) {
    $.ajax({
        type: "GET",
        url: "{:url('/index/ajax/getRemind')}",
        data: { 
            page: page,
            type: type === 'all' ? '' : type
        },
        dataType: "json",
        success: function(response) {
            if (response.status === 1 && response.data) {
                renderReminders(response.data.data, page === 1);
                hasMore = response.data.count === 20; // 假设每页20条，如果返回的数量等于每页数量则可能还有更多
                
                if (hasMore) {
                    $('#loadMore').show();
                } else {
                    $('#loadMore').hide();
                }
            } else {
                if (page === 1) {
                    $('#remindList').html('<div class="no-data">暂无提醒</div>');
                }
                $('#loadMore').hide();
            }
        },
        error: function() {
            if (page === 1) {
                $('#remindList').html('<div class="no-data">加载失败，请刷新重试</div>');
            }
        }
    });
}

function renderReminders(reminders, isFirstPage) {
    let html = '';
    
    if (reminders.length === 0) {
        html = '<div class="no-data">暂无提醒</div>';
    } else {
        reminders.forEach(function(item) {
            html += buildReminderItem(item);
        });
    }
    
    if (isFirstPage) {
        $('#remindList').html(html);
    } else {
        $('#remindList').append(html);
    }
}

function buildReminderItem(item) {
    // 根据提醒类型确定显示文本
    let typeText = '';
    let detailHtml = '';
    
    switch(parseInt(item.type)) {
        case 1: // 评论
            // 显示格式：评论了微博：原微博内容 - 评论内容（评论时间）
            if (item.extra && item.extra.msg_contents && item.extra.comment_contents && item.extra.comment_timestamp) {
                typeText = `评论了微博：<span style="color: #333;">${item.extra.msg_contents}</span>`;
                detailHtml = `<div class="remind-detail">评论内容：${item.extra.comment_contents}<br>评论时间：${formatTimeWithDate(item.extra.comment_timestamp)}</div>`;
            } else if (item.msg_contents && item.comment_contents && item.comment_timestamp) {
                typeText = `评论了微博：<span style="color: #333;">${item.msg_contents}</span>`;
                detailHtml = `<div class="remind-detail">评论内容：${item.comment_contents}<br>评论时间：${formatTimeWithDate(item.comment_timestamp)}</div>`;
            } else {
                typeText = '评论了你的微博';
                // 备选显示方案
                if (item.extra && item.extra.msg_contents) {
                    detailHtml += `<div class="remind-detail">原微博内容：${item.extra.msg_contents}</div>`;
                } else if (item.msg_contents) {
                    detailHtml += `<div class="remind-detail">原微博内容：${item.msg_contents}</div>`;
                }
                if (item.extra && item.extra.comment_contents) {
                    detailHtml += `<div class="remind-detail">评论内容：${item.extra.comment_contents}</div>`;
                } else if (item.comment_contents) {
                    detailHtml += `<div class="remind-detail">评论内容：${item.comment_contents}</div>`;
                }
                if (item.extra && item.extra.comment_timestamp) {
                    detailHtml += `<div class="remind-detail">评论时间：${formatTimeWithDate(item.extra.comment_timestamp)}</div>`;
                } else if (item.comment_timestamp) {
                    detailHtml += `<div class="remind-detail">评论时间：${formatTimeWithDate(item.comment_timestamp)}</div>`;
                } else if (item.ctime) {
                    detailHtml += `<div class="remind-detail">时间：${formatTimeWithDate(item.ctime)}</div>`;
                }
            }
            break;
        case 2: // 回复
            // 显示格式：回复了评论：原评论内容 - 回复内容（回复时间）
            if (item.extra && item.extra.comment_contents && item.extra.reply_contents && item.extra.reply_timestamp) {
                typeText = `回复了评论：<span style="color: #333;">${item.extra.comment_contents}</span>`;
                detailHtml = `<div class="remind-detail">回复内容：${item.extra.reply_contents}<br>回复时间：${formatTimeWithDate(item.extra.reply_timestamp)}</div>`;
            } else if (item.comment_contents && item.reply_contents && item.reply_timestamp) {
                typeText = `回复了评论：<span style="color: #333;">${item.comment_contents}</span>`;
                detailHtml = `<div class="remind-detail">回复内容：${item.reply_contents}<br>回复时间：${formatTimeWithDate(item.reply_timestamp)}</div>`;
            } else {
                typeText = '回复了你的评论';
                // 备选显示方案
                if (item.extra && item.extra.comment_contents) {
                    detailHtml += `<div class="remind-detail">原评论内容：${item.extra.comment_contents}</div>`;
                } else if (item.comment_contents) {
                    detailHtml += `<div class="remind-detail">原评论内容：${item.comment_contents}</div>`;
                }
                if (item.extra && item.extra.reply_contents) {
                    detailHtml += `<div class="remind-detail">回复内容：${item.extra.reply_contents}</div>`;
                } else if (item.reply_contents) {
                    detailHtml += `<div class="remind-detail">回复内容：${item.reply_contents}</div>`;
                }
                if (item.extra && item.extra.reply_timestamp) {
                    detailHtml += `<div class="remind-detail">回复时间：${formatTimeWithDate(item.extra.reply_timestamp)}</div>`;
                } else if (item.reply_timestamp) {
                    detailHtml += `<div class="remind-detail">回复时间：${formatTimeWithDate(item.reply_timestamp)}</div>`;
                } else if (item.ctime) {
                    detailHtml += `<div class="remind-detail">时间：${formatTimeWithDate(item.ctime)}</div>`;
                }
            }
            break;
        case 3: // 频道评论
            // 显示格式：评论了频道微博：频道微博内容 - 评论内容（评论时间）
            if (item.extra && item.extra.msg_contents && item.extra.comment_contents && item.extra.comment_timestamp) {
                typeText = `评论了频道微博：<span style="color: #333;">${item.extra.msg_contents}</span>`;
                detailHtml = `<div class="remind-detail">评论内容：${item.extra.comment_contents}<br>评论时间：${formatTimeWithDate(item.extra.comment_timestamp)}</div>`;
            } else if (item.msg_contents && item.comment_contents && item.comment_timestamp) {
                typeText = `评论了频道微博：<span style="color: #333;">${item.msg_contents}</span>`;
                detailHtml = `<div class="remind-detail">评论内容：${item.comment_contents}<br>评论时间：${formatTimeWithDate(item.comment_timestamp)}</div>`;
            } else {
                typeText = '评论了你的频道微博';
                // 备选显示方案
                if (item.extra && item.extra.msg_contents) {
                    detailHtml += `<div class="remind-detail">频道微博内容：${item.extra.msg_contents}</div>`;
                } else if (item.msg_contents) {
                    detailHtml += `<div class="remind-detail">频道微博内容：${item.msg_contents}</div>`;
                }
                if (item.extra && item.extra.comment_contents) {
                    detailHtml += `<div class="remind-detail">评论内容：${item.extra.comment_contents}</div>`;
                } else if (item.comment_contents) {
                    detailHtml += `<div class="remind-detail">评论内容：${item.comment_contents}</div>`;
                }
                if (item.extra && item.extra.comment_timestamp) {
                    detailHtml += `<div class="remind-detail">评论时间：${formatTimeWithDate(item.extra.comment_timestamp)}</div>`;
                } else if (item.comment_timestamp) {
                    detailHtml += `<div class="remind-detail">评论时间：${formatTimeWithDate(item.comment_timestamp)}</div>`;
                } else if (item.ctime) {
                    detailHtml += `<div class="remind-detail">时间：${formatTimeWithDate(item.ctime)}</div>`;
                }
            }
            break;
        case 4: // 频道回复
            // 显示格式：回复了频道评论：原频道评论内容 - 回复内容（回复时间）
            if (item.extra && item.extra.comment_contents && item.extra.reply_contents && item.extra.reply_timestamp) {
                typeText = `回复了频道评论：<span style="color: #333;">${item.extra.comment_contents}</span>`;
                detailHtml = `<div class="remind-detail">回复内容：${item.extra.reply_contents}<br>回复时间：${formatTimeWithDate(item.extra.reply_timestamp)}</div>`;
            } else if (item.comment_contents && item.reply_contents && item.reply_timestamp) {
                typeText = `回复了频道评论：<span style="color: #333;">${item.comment_contents}</span>`;
                detailHtml = `<div class="remind-detail">回复内容：${item.reply_contents}<br>回复时间：${formatTimeWithDate(item.reply_timestamp)}</div>`;
            } else {
                typeText = '回复了你的频道评论';
                // 备选显示方案
                if (item.extra && item.extra.comment_contents) {
                    detailHtml += `<div class="remind-detail">原频道评论内容：${item.extra.comment_contents}</div>`;
                } else if (item.comment_contents) {
                    detailHtml += `<div class="remind-detail">原频道评论内容：${item.comment_contents}</div>`;
                }
                if (item.extra && item.extra.reply_contents) {
                    detailHtml += `<div class="remind-detail">回复内容：${item.extra.reply_contents}</div>`;
                } else if (item.reply_contents) {
                    detailHtml += `<div class="remind-detail">回复内容：${item.reply_contents}</div>`;
                }
                if (item.extra && item.extra.reply_timestamp) {
                    detailHtml += `<div class="remind-detail">回复时间：${formatTimeWithDate(item.extra.reply_timestamp)}</div>`;
                } else if (item.reply_timestamp) {
                    detailHtml += `<div class="remind-detail">回复时间：${formatTimeWithDate(item.reply_timestamp)}</div>`;
                } else if (item.ctime) {
                    detailHtml += `<div class="remind-detail">时间：${formatTimeWithDate(item.ctime)}</div>`;
                }
            }
            break;
        case 5: // 关注
            typeText = '关注了你';
            // 从extra字段获取详细信息
            if (item.extra && item.extra.follow_time) {
                detailHtml = `<div class="remind-detail">关注时间：${formatTimeWithDate(item.extra.follow_time)}</div>`;
            } else if (item.ctime) {
                detailHtml = `<div class="remind-detail">关注时间：${formatTimeWithDate(item.ctime)}</div>`;
            }
            break;
        case 6: // 取消关注
            typeText = '取消关注了你';
            if (item.ctime) {
                detailHtml = `<div class="remind-detail">取消关注时间：${formatTimeWithDate(item.ctime)}</div>`;
            }
            break;
        case 7: // @提及
            // 显示格式：在微博中提到了你：微博内容（提及时间）
            if (item.extra && item.extra.msg_contents && item.extra.msg_timestamp) {
                typeText = `在微博中提到了你：<span style="color: #333;">${item.extra.msg_contents}</span>`;
                detailHtml = `<div class="remind-detail">提及时间：${formatTimeWithDate(item.extra.msg_timestamp)}</div>`;
            } else if (item.msg_contents && item.msg_timestamp) {
                typeText = `在微博中提到了你：<span style="color: #333;">${item.msg_contents}</span>`;
                detailHtml = `<div class="remind-detail">提及时间：${formatTimeWithDate(item.msg_timestamp)}</div>`;
            } else {
                typeText = '在微博中提到了你';
                // 备选显示方案
                if (item.extra && item.extra.msg_contents) {
                    detailHtml += `<div class="remind-detail">提及内容：${item.extra.msg_contents}</div>`;
                } else if (item.msg_contents) {
                    detailHtml += `<div class="remind-detail">提及内容：${item.msg_contents}</div>`;
                }
                if (item.extra && item.extra.msg_timestamp) {
                    detailHtml += `<div class="remind-detail">提及时间：${formatTimeWithDate(item.extra.msg_timestamp)}</div>`;
                } else if (item.msg_timestamp) {
                    detailHtml += `<div class="remind-detail">提及时间：${formatTimeWithDate(item.msg_timestamp)}</div>`;
                } else if (item.ctime) {
                    detailHtml += `<div class="remind-detail">时间：${formatTimeWithDate(item.ctime)}</div>`;
                }
            }
            break;
        case 8: // 收藏微博
            typeText = '收藏了你的微博';
            // 从extra字段获取详细信息
            if (item.extra && item.extra.msg_contents) {
                detailHtml = `<div class="remind-detail">收藏内容：${item.extra.msg_contents}</div>`;
            } else if (item.msg_contents) {
                detailHtml = `<div class="remind-detail">收藏内容：${item.msg_contents}</div>`;
            }
            // 如果有收藏时间也显示
            if (item.extra && item.extra.collect_timestamp) {
                detailHtml += detailHtml ? `<br>收藏时间：${formatTimeWithDate(item.extra.collect_timestamp)}` : `<div class="remind-detail">收藏时间：${formatTimeWithDate(item.extra.collect_timestamp)}</div>`;
            } else if (item.ctime) {
                detailHtml += detailHtml ? `<br>收藏时间：${formatTimeWithDate(item.ctime)}` : `<div class="remind-detail">收藏时间：${formatTimeWithDate(item.ctime)}</div>`;
            }
            break;
        case 9: // 收藏频道微博
            typeText = '收藏了你的频道微博';
            // 从extra字段获取详细信息
            if (item.extra && item.extra.msg_contents) {
                detailHtml = `<div class="remind-detail">收藏内容：${item.extra.msg_contents}</div>`;
            } else if (item.msg_contents) {
                detailHtml = `<div class="remind-detail">收藏内容：${item.msg_contents}</div>`;
            }
            // 如果有收藏时间也显示
            if (item.extra && item.extra.collect_timestamp) {
                detailHtml += detailHtml ? `<br>收藏时间：${formatTimeWithDate(item.extra.collect_timestamp)}` : `<div class="remind-detail">收藏时间：${formatTimeWithDate(item.extra.collect_timestamp)}</div>`;
            } else if (item.ctime) {
                detailHtml += detailHtml ? `<br>收藏时间：${formatTimeWithDate(item.ctime)}` : `<div class="remind-detail">收藏时间：${formatTimeWithDate(item.ctime)}</div>`;
            }
            break;
        default:
            typeText = item.note || '有新的互动';
            // 尝试从其他字段获取内容
            if (item.content_preview) {
                typeText += `：<span style="color: #333;">${item.content_preview}</span>`;
            }
            if (item.ctime) {
                detailHtml = `<div class="remind-detail">时间：${formatTimeWithDate(item.ctime)}</div>`;
            }
    }
    
    // 格式化时间
    const timeString = formatTime(item.ctime);
    // console.log(item);
    // 构建提醒项HTML
    return `
    <div class="remind-item" data-id="${item.reminder_id}">
        <div class="remind-header">
            <img src="${item.from_head_image || item.extra?.from_head_image || '/static/images/default_avatar.png'}" class="remind-avatar" alt="${item.from_nickname || item.extra?.from_nickname}">
            <div class="remind-user">${item.from_nickname || item.extra?.from_nickname}</div>
        </div>
        <div class="remind-content">
            <div class="remind-text">
                ${typeText}
            </div>
            ${detailHtml}
            <div class="remind-time">${timeString}</div>
            <div class="remind-actions">
                <button class="read-btn" onclick="markAsRead(${item.reminder_id})">标记已读</button>
                <button class="view-btn" onclick="viewDetail(${item.type}, ${item.reminder_id}, ${item.extra.msg_id || 0}, ${item.extra.cid || 0}, ${item.extra.rid || 0})">查看</button>
            </div>
        </div>
    </div>
    `;
}

function formatTime(timestamp) {
    const date = new Date(timestamp * 1000);
    const now = new Date();
    const diff = now.getTime() - date.getTime();
    const dayDiff = Math.floor(diff / (1000 * 60 * 60 * 24));
    
    if (dayDiff === 0) {
        // 今天
        return date.getHours() + ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();
    } else if (dayDiff === 1) {
        return '昨天 ' + date.getHours() + ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();
    } else {
        return (date.getMonth() + 1) + '-' + date.getDate();
    }
}

function formatTimeWithDate(timestamp) {
    if (!timestamp) return '';
    const date = new Date(timestamp * 1000);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const seconds = String(date.getSeconds()).padStart(2, '0');
    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
}

function markAsRead(cid, rid) {
    $.ajax({
        type: "POST",
        url: "{:url('/index/ajax/markRead')}",
        data: { reminder_id: cid, rid },
        dataType: "json",
        success: function(response) {
            if (response.status === 1) {
                // 移除已读提醒项
                $(`.remind-item[data-id="${cid, rid}"]`).fadeOut(300, function() {
                    $(this).remove();
                    if ($('.remind-item').length === 0) {
                        $('#remindList').html('<div class="no-data">暂无提醒</div>');
                    }
                });
                // 更新头部提醒计数
                updateHeaderRemindCount(-1);
            } else {
                layer.msg(response.msg || '标记失败');
            }
        },
        error: function() {
            layer.msg('网络错误');
        }
    });
}

function viewDetail(type, reminderId, msgId, cid, rid) {
    // 根据类型跳转到相应的详情页
    let url = '';
    switch(parseInt(type)) {
        case 1: // 评论
        case 2: // 回复
        case 7: // @提及
            var blog = '{$userInfo.blog}';
            var uri = `msgId=${msgId}&cid=${cid}&rid=${rid}&reminderId=${reminderId}`;
            uri = base64Encode(uri);
            url = `/${blog}/message/${uri}`;
            break;
        case 3: // 频道评论
        case 4: // 频道回复
            url = `/index/index/msgdetail/id/${msgId}`; // 或者跳转到频道详情页
            break;
        case 5: // 关注
            url = `/index/user/space/uid/${item.from_uid || 0}`; // 跳转到关注者主页
            break;
        case 8: // 收藏微博
        case 9: // 收藏频道微博
            url = `/index/index/msgdetail/id/${msgId}`;
            break;
        default:
            url = `/index/index/msgdetail/id/${msgId}`;
    }
    
    window.open(url, '_blank');
}

function loadMoreReminders() {
    if (!hasMore) return;
    currentPage++;
    loadReminders(currentType, currentPage);
}

function updateHeaderRemindCount(delta) {
    const countElement = $('.remind-count'); // 假设有这样的元素
    if (countElement.length > 0) {
        let currentCount = parseInt(countElement.text()) || 0;
        currentCount += delta;
        if (currentCount < 0) currentCount = 0;
        if (currentCount > 0) {
            countElement.text(currentCount);
            countElement.show();
        } else {
            countElement.hide();
        }
    }
}

// 滚动到底部自动加载更多
$(window).scroll(function() {
    if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
        if (hasMore) {
            loadMoreReminders();
        }
    }
});
</script>