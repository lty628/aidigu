<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>嘀咕~ 谁在这里？</title>
<meta name="description" content="爱嘀咕,微博" />
<meta name="keywords" content="weibo,微博"/>
<link rel="stylesheet" href="/static/layui/css/layui.css?t=1" type="text/css" media="screen" />
<link rel="stylesheet" href="/static/index/css/main.css?38" type="text/css" media="screen" />
<link class="dplayer-css" rel="stylesheet" href="/static/dplayer/css/DPlayer.min.css">
<script src="/static/index/js/jquery-1.8.3.min.js"></script>
<script src="/static/layui/layui.js?4"></script>
<script src="/static/dplayer/js/hls.light.min.js"></script>
<script src="/static/dplayer/js/DPlayer.min.js"></script>
<script language="javascript" type="text/javascript" src="/static/index/js/common.js?19"></script>
<script language="javascript" type="text/javascript" src="/static/common/js/index.js?22"></script>
<script language="javascript" type="text/javascript" src="/static/common/js/common.js?19"></script>
<script language="javascript" type="text/javascript" src="/static/index/js/video.js?11"></script>

{if $userInfo}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 从 localStorage 中读取保存的主题
        // var selectedTheme = localStorage.getItem('selectedTheme');
		var selectedTheme = '{$siteTheme}';
        if (selectedTheme) {
            if (selectedTheme === 'default') {
                document.documentElement.className = '';
            } else {
                document.documentElement.className = selectedTheme;
            }
            var header = document.getElementById('header');
            if (header) {
                if (selectedTheme === 'default') {
                    header.className = '';
                } else {
                    header.className = selectedTheme;
                }
            }
        }
    });
</script>
{/if}

</head>

<body>
<input type="hidden" id="siteTheme" value="{$siteTheme}">
{if $userInfo && $siteBg}
<div class="background-blur" style="background: url({$siteBg}) no-repeat 0 0;background-attachment:fixed;background-size:100% 100%;height:auto;min-height: 100%"></div>
{else}
<div class="background-blur" style="filter: blur(1px);background: url(/static/index/images/bg.jpg) no-repeat 0 0;background-attachment:fixed;background-size:100% 100%;height:auto;min-height: 100%"></div>
<script>
    // 粒子动画 - 优化版本
    (function() {
        // 配置参数
        const CONFIG = {
            particleCount: 80,
            minSize: 1,
            maxSize: 5,
            minSpeed: -0.25,
            maxSpeed: 0.25,
            minAlpha: 0.3,
            maxAlpha: 0.8,
            colorPalette: [
                'rgba(255, 107, 107, {alpha})', // 红色系
                'rgba(107, 185, 255, {alpha})', // 蓝色系
                'rgba(173, 107, 255, {alpha})', // 紫色系
                'rgba(107, 255, 185, {alpha})'  // 青色系
            ],
            zIndex: 1,
            pointerEvents: 'none'
        };

        let canvas, ctx, particles = [], animationId;

        // 粒子类
        class Particle {
            constructor(width, height) {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * (CONFIG.maxSize - CONFIG.minSize) + CONFIG.minSize;
                this.speedX = Math.random() * (CONFIG.maxSpeed - CONFIG.minSpeed) + CONFIG.minSpeed;
                this.speedY = Math.random() * (CONFIG.maxSpeed - CONFIG.minSpeed) + CONFIG.minSpeed;
                const alpha = Math.random() * (CONFIG.maxAlpha - CONFIG.minAlpha) + CONFIG.minAlpha;
                const colorTemplate = CONFIG.colorPalette[Math.floor(Math.random() * CONFIG.colorPalette.length)];
                this.color = colorTemplate.replace('{alpha}', alpha);
            }

            update(width, height) {
                this.x += this.speedX;
                this.y += this.speedY;

                // 边界检测和反弹
                if (this.x <= 0 || this.x >= width) {
                    this.speedX *= -1;
                    this.x = Math.max(0, Math.min(width, this.x)); // 防止超出边界
                }
                if (this.y <= 0 || this.y >= height) {
                    this.speedY *= -1;
                    this.y = Math.max(0, Math.min(height, this.y)); // 防止超出边界
                }
            }

            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        // 初始化画布和粒子
        function init() {
            canvas = document.createElement('canvas');
            ctx = canvas.getContext('2d');

            // 设置画布尺寸
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // 设置画布样式
            Object.assign(canvas.style, {
                position: 'absolute',
                top: '0',
                left: '0',
                zIndex: CONFIG.zIndex.toString(),
                pointerEvents: CONFIG.pointerEvents
            });

            // 添加到背景容器
            document.querySelector('.background-blur').appendChild(canvas);

            // 创建粒子
            particles = [];
            for (let i = 0; i < CONFIG.particleCount; i++) {
                particles.push(new Particle(canvas.width, canvas.height));
            }

            // 开始动画循环
            animate();
        }

        // 动画循环
        function animate() {
            // 清除画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 更新和绘制每个粒子
            for (const particle of particles) {
                particle.update(canvas.width, canvas.height);
                particle.draw(ctx);
            }

            // 继续动画循环
            animationId = requestAnimationFrame(animate);
        }

        // 窗口大小调整处理
        function handleResize() {
            if (!canvas) return;
            
            // 保存当前粒子位置比例
            const widthRatio = window.innerWidth / canvas.width;
            const heightRatio = window.innerHeight / canvas.height;

            // 更新画布尺寸
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // 按比例调整粒子位置，保持相对位置
            for (const particle of particles) {
                particle.x *= widthRatio;
                particle.y *= heightRatio;
            }
        }

        // 添加事件监听器
        window.addEventListener('resize', handleResize);

        // 页面可见性变化时暂停/恢复动画
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            } else {
                if (!animationId) {
                    animate();
                }
            }
        });

        // 页面卸载时清理资源
        window.addEventListener('beforeunload', function() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            if (canvas && canvas.parentNode) {
                canvas.parentNode.removeChild(canvas);
            }
        });

        // 启动初始化
        init();
    })();
</script>
{/if}

<div class="container">
<div class="header">
	<!-- <div class="logo"><a href="/"><img src="/static/index/images/logo.gif" alt="logo"/></a></div> -->
	<div class="navigation">
		<ul>
			{if $userInfo}
				{if $userInfo.isSiteUser}
					<li><a href="{:url('/'.$loginUserInfo.blog.'/')}">我的首页</a></li>
					<li><a href="{:url('/'.$loginUserInfo.blog.'/own/')}">我的微博</a></li>
					<li><a href="/square/">广场</a></li>
					<li><a href="/collect/">我的收藏</a></li>
					<li><a href="/topic/">话题</a></li>
					<li><a href="/channel/">频道</a></li>
					<!-- <li><a href="/search/">搜索</a></li> -->
					<li><a href="/hotnews/">新闻热点</a></li>
					{if $checkRemind['messageRemind']}
					<!-- <li>
						<a href="/remind/">提醒</a>
						<span class="layui-badge-dot layui-bg-blue" id="checkmessageRemind"></span>
					</li> -->
					{/if}
					<li>
						<a href="/tools/">小应用</a>
						{if $checkRemind['chatRemind']}
						<span class="layui-badge-dot layui-bg-blue" id="checkRemind"></span>
						{else} 
						<span class="layui-badge-dot layui-bg-blue" id="checkRemind" style="display: none;"></span>
						{/if}
					</li>
					<!-- <li><a href="javascript:;" data-title="我的云盘" data-url="/cloud/show/" onclick="showFrameHtml(this, '80%', '80%')">网盘</a></li> -->
					<!-- <li><a href="javascript:;" data-title="在线影院" data-url="/movie" onclick="showFrameHtml(this, '100%', '100%')">影院</a></li> -->
					<li><a href="/setting/">设置</a></li>
					<li><a href="/tools/nav/">导航</a></li>
				{else}
					<li><a href="{:url('/'.$userInfo.blog.'/')}">{$userInfo.sex|getPerson}的首页</a></li>
					<li><a href="{:url('/'.$userInfo.blog.'/own/')}">{$userInfo.sex|getPerson}的微博</a></li>
					<li><a href="/square/">广场</a></li>
					<!-- <li><a href="{:url('/'.$userInfo.blog.'/collect/')}">{$userInfo.sex|getPerson}的收藏</a></li> -->
					<li><a href="javascript:;" data-title="私信" data-url="/chat/private/{$userInfo.uid}" onclick="showFrameHtml(this, '60%', '70%')">私信{$userInfo.sex|getPerson}</a></li>
                    <li><a href="javascript:;" data-title="时光邮局" data-url="/tools/letter?touser={$userInfo.blog}" onclick="showFrameHtml(this, '60%', '100%', 1)">写信给{$userInfo.sex|getPerson}</a></li>
                    <li><a href="javascript:;" data-title="表白墙" data-url="/tools/lovewall?touser={$userInfo.blog}" onclick="showFrameHtml(this, '60%', '100%', 1)">表白{$userInfo.sex|getPerson}</a></li>
					<li><a href="{:url('/'.$loginUserInfo.blog.'/')}">我的首页</a></li>
					<!-- <li><a href="/topic/">话题</a></li> -->
				{/if}
				{if $userInfo.uid == 1}
				<li><a href="{:url('/admin/')}">后台管理</a></li>
				{/if}
				<li><a href="{:url('/logout/')}">退出</a></li>
			{else} 
				<li><a href="/">首页</a></li>
				<li><a href="/tools/bmi">体重计算器</a></li>
				<li><a href="/tools/reader">文本阅读器</a></li>
				<li><a href="{:url('/login/')}">登录</a></li>

			{/if}
 		</ul>
		
	</div>
	<div class="clear"></div>
</div>