<!DOCTYPE html>
<html>

<head>
	<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
	<meta charset="utf-8">
	<meta name="renderer" content="webkit">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<title>èŠå¤©</title>
	<style>
		/* é‡ç½®æ ·å¼ */
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		html, body {
			width: 100%;
			height: 100%;
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
			font-size: 16px;
			color: #333;
			background-color: #f5f5f5;
			overflow: hidden;
			touch-action: manipulation; /* æå‡è§¦æ‘¸å“åº”æ€§èƒ½ */
		}
		
		/* ä¸»å®¹å™¨ */
		#mobile-container {
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
		}
		
		/* é¡¶éƒ¨å¯¼èˆªæ  */
		#mobile-header {
			height: 50px;
			background-color: #008CEE;
			color: white;
			display: flex;
			align-items: center;
			padding: 0 15px;
			position: relative;
			z-index: 10;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
			-webkit-tap-highlight-color: transparent; /* ç§»é™¤ç‚¹å‡»é«˜äº® */
		}
		
		#mobile-header .back-btn {
			font-size: 16px;
			margin-right: 20px;
			cursor: pointer;
			padding: 5px;
		}
		
		#mobile-header .title {
			flex: 1;
			text-align: center;
			font-size: 18px;
			font-weight: 500;
			margin-right: 20px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		
		#mobile-header .right-icon {
			font-size: 20px;
			padding: 5px;
		}
		
		/* èŠå¤©åˆ—è¡¨é¡µé¢ */
		#chat-list-page {
			flex: 1;
			overflow-y: auto;
			background-color: #f5f5f5;
			-webkit-overflow-scrolling: touch; /* å¯ç”¨æƒ¯æ€§æ»šåŠ¨ */
		}
		
		.chat-item {
			display: flex;
			align-items: center;
			padding: 12px 15px;
			background-color: white;
			border-bottom: 1px solid #f0f0f0;
			cursor: pointer;
			transition: background-color 0.2s ease;
			-webkit-tap-highlight-color: rgba(0,0,0,0.1);
		}
		
		.chat-item:hover {
			background-color: #f9f9f9;
		}
		
		.chat-item .avatar {
			width: 50px;
			height: 50px;
			border-radius: 50%;
			overflow: hidden;
			background-color: #e0e0e0;
			margin-right: 12px;
			flex-shrink: 0; /* é˜²æ­¢å¤´åƒè¢«å‹ç¼© */
		}
		
		.chat-item .avatar img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
		
		.chat-item .info {
			flex: 1;
			min-width: 0;
			display: flex;
			flex-direction: column;
			justify-content: center;
		}
		
		.chat-item .info .name {
			font-size: 16px;
			font-weight: 500;
			margin-bottom: 4px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		
		.chat-item .info .message {
			font-size: 14px;
			color: #999;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		
		.chat-item .time {
			font-size: 12px;
			color: #999;
			margin-left: 10px;
			align-self: flex-start;
		}
		
		.chat-item .badge {
			background-color: #ff4234;
			color: white;
			font-size: 12px;
			padding: 2px 6px;
			border-radius: 10px;
			min-width: 20px;
			text-align: center;
			margin-top: 5px;
			align-self: flex-start;
		}
		
		/* èŠå¤©è¯¦æƒ…é¡µé¢ */
		#chat-detail-page {
			flex: 1;
			display: flex;
			flex-direction: column;
			background-color: #f8faff;
			position: absolute;
			top: 50px;
			left: 0;
			width: 100%;
			height: calc(100% - 50px);
			transform: translateX(100%);
			transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* æ›´å¹³æ»‘çš„åŠ¨ç”» */
			z-index: 20;
			overflow: hidden;
		}
		
		#chat-detail-page.active {
			transform: translateX(0);
		}
		
		.chat-content {
			flex: 1;
			overflow-y: auto;
			padding: 15px;
			background-color: #f8faff;
			-webkit-overflow-scrolling: touch; /* å¯ç”¨æƒ¯æ€§æ»šåŠ¨ */
		}
		
		.msg-wrapper {
			margin-bottom: 20px;
			position: relative;
			display: flex;
			align-items: flex-end;
		}
		
		.msg-wrapper.self {
			flex-direction: row-reverse;
			margin-left: auto;
			max-width: 85%;
		}
		
		.msg-wrapper.other {
			margin-right: auto;
			max-width: 85%;
		}
		
		.msg-wrapper .avatar {
			width: 36px;
			height: 36px;
			border-radius: 50%;
			overflow: hidden;
			background-color: #e0e0e0;
			margin: 0 8px;
			flex-shrink: 0; /* é˜²æ­¢å¤´åƒè¢«å‹ç¼© */
		}
		
		.msg-wrapper .avatar img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
		
		.msg-wrapper .msg-content {
			background-color: white;
			padding: 10px 12px;
			border-radius: 12px;
			position: relative;
			word-break: break-word;
			max-width: calc(100% - 52px);
			box-shadow: 0 1px 2px rgba(0,0,0,0.1);
		}
		
		.msg-wrapper.self .msg-content {
			background-color: #91d5ff;
			border-bottom-right-radius: 4px; /* åˆ›å»ºèŠå¤©æ°”æ³¡æ•ˆæœ */
		}
		
		.msg-wrapper.other .msg-content {
			border-bottom-left-radius: 4px; /* åˆ›å»ºèŠå¤©æ°”æ³¡æ•ˆæœ */
		}
		
		.msg-wrapper .msg-time {
			font-size: 11px;
			color: #999;
			text-align: center;
			margin: 0 8px;
			margin-bottom: 2px;
		}
		
		/* è¾“å…¥åŒºåŸŸ */
		.input-area {
			background-color: white;
			padding: 10px;
			border-top: 1px solid #f0f0f0;
			position: relative;
			display: flex;
			flex-direction: column;
		}
		
		.input-toolbar {
			display: flex;
			align-items: center;
			margin-bottom: 8px;
		}
		
		.input-toolbar .tool-icon {
			font-size: 24px;
			margin-right: 15px;
			color: #666;
			cursor: pointer;
			padding: 5px;
			-webkit-tap-highlight-color: rgba(0,0,0,0.1);
		}
		
		.input-box {
			background-color: #f5f5f5;
			border-radius: 20px;
			padding: 8px 15px;
			min-height: 40px;
			max-height: 120px;
			overflow-y: auto;
			outline: none;
			border: none;
			resize: none;
			font-size: 16px;
			line-height: 1.4;
			min-height: 45px;
		}
		
		.send-btn {
			position: absolute;
			bottom: 20px;
			right: 15px;
			background-color: #008CEE;
			color: white;
			border: none;
			padding: 8px 18px;
			border-radius: 20px;
			font-size: 14px;
			outline: none;
			cursor: pointer;
			transition: background-color 0.2s ease;
			box-shadow: 0 2px 4px rgba(0,140,238,0.3);
		}
		
		.send-btn:hover:not(:disabled) {
			background-color: #0077cc;
		}
		
		.send-btn:disabled {
			background-color: #ccc;
			cursor: not-allowed;
		}
		
		/* åŠ è½½æ›´å¤š */
		.load-more {
			text-align: center;
			padding: 10px;
			color: #999;
			font-size: 14px;
		}
		
		/* ç©ºçŠ¶æ€ */
		.empty-state {
			text-align: center;
			padding: 50px 20px;
			color: #999;
		}
		
		.empty-state .icon {
			font-size: 50px;
			margin-bottom: 15px;
		}
		
		/* åŠ¨ç”» */
		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		
		.msg-wrapper {
			animation: fadeIn 0.3s ease;
		}
		
		/* å“åº”å¼è®¾è®¡ä¼˜åŒ– */
		@media screen and (max-width: 320px) {
			#mobile-header {
				height: 45px;
				padding: 0 10px;
			}
			
			#mobile-header .title {
				font-size: 16px;
			}
			
			.chat-item {
				padding: 10px 12px;
			}
			
			.chat-item .avatar {
				width: 45px;
				height: 45px;
			}
			
			.msg-wrapper .avatar {
				width: 32px;
				height: 32px;
			}
			
			.msg-wrapper .msg-content {
				padding: 8px 10px;
				font-size: 14px;
			}
		}
		
		/* æ·±è‰²æ¨¡å¼æ”¯æŒ */
		@media (prefers-color-scheme: dark) {
			html, body {
				background-color: #1a1a1a;
				color: #e0e0e0;
			}
			
			#chat-list-page {
				background-color: #1a1a1a;
			}
			
			.chat-item {
				background-color: #2d2d2d;
				border-bottom-color: #404040;
			}
			
			.chat-item:hover {
				background-color: #3a3a3a;
			}
			
			.chat-item .info .message {
				color: #aaa;
			}
			
			.chat-item .time {
				color: #aaa;
			}
			
			#chat-detail-page {
				background-color: #1e1e1e;
			}
			
			.chat-content {
				background-color: #1e1e1e;
			}
			
			.msg-wrapper .msg-content {
				background-color: #2d2d2d;
				color: #e0e0e0;
			}
			
			.input-area {
				background-color: #2d2d2d;
				border-top-color: #404040;
			}
			
			.input-box {
				background-color: #3a3a3a;
				color: #e0e0e0;
			}
		}
	</style>
</head>

<body>
	<div id="mobile-container">
		<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
		<div id="mobile-header">
			<div class="back-btn" id="backBtn">è¿”å›</div>
			<div class="title" id="pageTitle">èŠå¤©åˆ—è¡¨</div>
			<div class="right-icon" id="headerRightIcon"></div>
		</div>
		
		<!-- èŠå¤©åˆ—è¡¨é¡µé¢ -->
		<div id="chat-list-page">
			<div class="chat-list" id="chat-list"></div>
		</div>
		
		<!-- èŠå¤©è¯¦æƒ…é¡µé¢ -->
		<div id="chat-detail-page">
			<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
			<div class="chat-content" id="chat-content">
				<div id="chat-messages"></div>
				<div class="load-more" id="load-more">ä¸Šæ‹‰åŠ è½½æ›´å¤š</div>
			</div>
			
			<!-- è¾“å…¥åŒºåŸŸ -->
			<div class="input-area">
				<div class="input-toolbar">
					<div class="tool-icon" id="emojiBtn">ğŸ˜Š</div>
					<div class="tool-icon" id="imageBtn">ğŸ“·</div>
				</div>
				<div class="input-box" id="msgInput" contenteditable="true" placeholder="è¾“å…¥æ¶ˆæ¯..."></div>
				<button class="send-btn" id="sendBtn" disabled>å‘é€</button>
			</div>
		</div>
	</div>
	
	<input type="hidden" value="{$touid}" id="privateToUid">
	<input type="hidden" value="{$messageChatId}" id="messageChatId">
	<input type="hidden" value="{$fromuid}" id="privateFromUid">
	<input type="hidden" id="mediaVal">

	<!-- é¦–å…ˆå¼•å…¥æ‰€æœ‰å¿…è¦çš„è„šæœ¬ -->
	<script src="/static/chat/js/jquery.min.js"></script>
	<script src="/static/chat/js/face.js?v=3345"></script>
	<script src="/static/chat/js/create.div.js?v=34"></script>
	<script src="/static/chat/js/functions.js?v=2115"></script>
	<script src="/static/chat/js/xlyjs.js?v=215"></script>
	<script src="/static/layui/layui.js?4"></script>
	<script language="javascript" type="text/javascript" src="/static/common/js/index.js?22"></script>
	<script type="text/javascript" src="/static/common/js/wangEditor.min.js"></script>
	<script src="/static/chat/js/edit.js?v=12"></script>
	
	<script>
		// é…ç½®
		var config = {
			'wsserver' : "{$wsserver}"
		};
		
		// é¿å…jQueryå†²çªï¼Œä½¿ç”¨å®‰å…¨çš„DOMé€‰æ‹©å™¨
		function getElement(id) { 
			return document.getElementById(id); 
		}
		
		// é¡µé¢å…ƒç´ 
		var chatListPage = getElement('chat-list-page');
		var chatDetailPage = getElement('chat-detail-page');
		var backBtn = getElement('backBtn');
		var pageTitle = getElement('pageTitle');
		var msgInput = getElement('msgInput');
		var sendBtn = getElement('sendBtn');
		var chatList = getElement('chat-list');
		var chatMessages = getElement('chat-messages');
		
		// é¡µé¢çŠ¶æ€
		var currentChatId = '';
		var currentChatName = '';
		
		// åˆå§‹åŒ–
		document.addEventListener('DOMContentLoaded', function() {
			// åˆå§‹åŒ–è¾“å…¥æ¡†äº‹ä»¶
			initInputEvents();
			
			// åˆå§‹åŒ–é¡µé¢åˆ‡æ¢äº‹ä»¶
			initPageEvents();
			
			// åŠ è½½èŠå¤©åˆ—è¡¨
			loadChatList();
			
			// å¦‚æœæœ‰æŒ‡å®šçš„èŠå¤©IDï¼Œç›´æ¥è¿›å…¥èŠå¤©è¯¦æƒ…
			var messageChatId = getElement('messageChatId').value;
			var touid = getElement('privateToUid').value;
			var fromuid = getElement('privateFromUid').value;
			
			if (messageChatId || touid) {
				var chatId = messageChatId || touid;
				enterChatDetail(chatId, 'èŠå¤©');
			}
		});
		
		// åˆå§‹åŒ–è¾“å…¥æ¡†äº‹ä»¶
		function initInputEvents() {
			// ç›‘å¬è¾“å…¥æ¡†å˜åŒ–
			msgInput.addEventListener('input', function() {
				sendBtn.disabled = !msgInput.innerText.trim();
			});
			
			// å‘é€æŒ‰é’®ç‚¹å‡»
			sendBtn.addEventListener('click', function() {
				sendMessage();
			});
			
			// è¾“å…¥æ¡†å›è½¦å‘é€
			msgInput.addEventListener('keydown', function(e) {
				if (e.key === 'Enter' && !e.shiftKey) {
					e.preventDefault();
					sendMessage();
				}
			});
		}
		
		// åˆå§‹åŒ–é¡µé¢äº‹ä»¶
		function initPageEvents() {
			// è¿”å›æŒ‰é’®ç‚¹å‡»
			backBtn.addEventListener('click', function() {
				if (chatDetailPage.classList.contains('active')) {
					exitChatDetail();
				}
			});
		}
		
		// åŠ è½½èŠå¤©åˆ—è¡¨
		function loadChatList() {
			// ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ˜¾ç¤ºèŠå¤©åˆ—è¡¨
			var chats = [
				{id: 1, name: 'å¼ ä¸‰', avatar: '/static/images/avatar1.jpg', lastMsg: 'ä½ å¥½ï¼', time: '10:30', unread: 2},
				{id: 2, name: 'æå››', avatar: '/static/images/avatar2.jpg', lastMsg: 'æ˜å¤©è§', time: 'æ˜¨å¤©', unread: 0}
			];
			
			var html = '';
			chats.forEach(chat => {
				html += `
					<div class="chat-item" data-id="${chat.id}">
						<div class="avatar">
							<img src="${chat.avatar}" alt="${chat.name}">
						</div>
						<div class="info">
							<div class="name">${chat.name}</div>
							<div class="message">${chat.lastMsg}</div>
						</div>
						<div>
							<div class="time">${chat.time}</div>
							${chat.unread > 0 ? `<div class="badge">${chat.unread}</div>` : ''}
						</div>
				</div>
			`;
			});
			chatList.innerHTML = html;
			
			// ç»‘å®šç‚¹å‡»äº‹ä»¶
			var chatItems = document.querySelectorAll('.chat-item');
			chatItems.forEach(item => {
				item.addEventListener('click', function() {
					var id = this.dataset.id;
					var name = this.querySelector('.name').innerText;
					enterChatDetail(id, name);
				});
			});
		}
		
		// è¿›å…¥èŠå¤©è¯¦æƒ…é¡µ
		function enterChatDetail(chatId, chatName) {
			currentChatId = chatId;
			currentChatName = chatName;
			pageTitle.innerText = chatName;
			chatDetailPage.classList.add('active');
			
			// åŠ è½½èŠå¤©æ¶ˆæ¯
			loadChatMessages(chatId);
			
			// èšç„¦è¾“å…¥æ¡†
			msgInput.focus();
		}
		
		// é€€å‡ºèŠå¤©è¯¦æƒ…é¡µ
		function exitChatDetail() {
			chatDetailPage.classList.remove('active');
			pageTitle.innerText = 'èŠå¤©åˆ—è¡¨';
			currentChatId = '';
			currentChatName = '';
		}
		
		// åŠ è½½èŠå¤©æ¶ˆæ¯
		function loadChatMessages(chatId) {
			// ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ˜¾ç¤ºèŠå¤©æ¶ˆæ¯
			var messages = [
				{id: 1, content: 'ä½ å¥½ï¼', type: 'other', time: '10:30', avatar: '/static/images/avatar1.jpg'},
				{id: 2, content: 'ä½ å¥½ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„ï¼Ÿ', type: 'self', time: '10:31', avatar: '/static/images/default_avatar.jpg'},
				{id: 3, content: 'æˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹äº§å“ä¿¡æ¯', type: 'other', time: '10:32', avatar: '/static/images/avatar1.jpg'}
			];
			
			var html = '';
			messages.forEach(msg => {
				html += `
					<div class="msg-wrapper ${msg.type}">
						<div class="msg-time">${msg.time}</div>
						<div class="avatar">
							<img src="${msg.avatar || '/static/images/default_avatar.jpg'}" alt="">
						</div>
						<div class="msg-content">${msg.content}</div>
				</div>
			`;
			});
			chatMessages.innerHTML = html;
			
			// æ»šåŠ¨åˆ°åº•éƒ¨
			scrollToBottom();
		}
		
		// å‘é€æ¶ˆæ¯
		function sendMessage() {
			var content = msgInput.innerText.trim();
			if (!content || !currentChatId) return;
			
			// æ¸…ç©ºè¾“å…¥æ¡†
			msgInput.innerText = '';
			sendBtn.disabled = true;
			
			// æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢
			var now = new Date();
			var time = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
			
			var msgHtml = `
				<div class="msg-wrapper self">
					<div class="msg-time">${time}</div>
					<div class="avatar">
						<img src="/static/images/default_avatar.jpg" alt="">
					</div>
					<div class="msg-content">${content}</div>
				</div>
			`;
			
			chatMessages.insertAdjacentHTML('beforeend', msgHtml);
			
			// æ»šåŠ¨åˆ°åº•éƒ¨
			scrollToBottom();
			
			// å°è¯•è°ƒç”¨åŸæœ‰çš„å‘é€æ¶ˆæ¯åŠŸèƒ½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
			try {
				if (typeof window.chat !== 'undefined' && typeof window.chat.sendMessage === 'function') {
					// å­˜å‚¨å½“å‰æ¶ˆæ¯å†…å®¹ä¾›åŸå‡½æ•°ä½¿ç”¨
					getElement('mediaVal').value = content;
					// è°ƒç”¨åŸå‡½æ•°
					window.chat.sendMessage();
				} else {
					console.log('å‘é€æ¶ˆæ¯:', content);
				}
			} catch (e) {
				console.error('å‘é€æ¶ˆæ¯æ—¶å‡ºé”™:', e);
			}
		}
		
		// æ»šåŠ¨åˆ°åº•éƒ¨
		function scrollToBottom() {
			var chatContent = getElement('chat-content');
			chatContent.scrollTop = chatContent.scrollHeight;
		}
		
		// é€‚é…åŸæœ‰çš„èŠå¤©åŠŸèƒ½
		window.mobileChat = {
			enterChatDetail: enterChatDetail,
			exitChatDetail: exitChatDetail,
			sendMessage: sendMessage,
			loadChatMessages: loadChatMessages,
			loadChatList: loadChatList
		};
		
		// ç¡®ä¿ä¸åŸç³»ç»Ÿå…¼å®¹
		if (typeof window.chat === 'undefined') {
			window.chat = {
				sendMessage: function() {
					console.log('å‘é€æ¶ˆæ¯:', msgInput.innerText.trim());
				},
				showGroupUser: function() {
					console.log('æ˜¾ç¤ºç¾¤æˆå‘˜');
				}
			};
		}
	</script>
</body>
</html>

</html>