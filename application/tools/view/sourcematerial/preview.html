<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/static/layui/css/layui.css" rel="stylesheet">
  <style>

    .flow-div .flow-div-img {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1%;
    }

    .flow-div .flow-div .flow-div-img li {
      height: 220px;
      overflow: hidden;
    }

    .flow-div .flow-div-img li img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .flow-div .flow-div-video {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1%;
      margin-top: 5px;
    }

    .flow-div video {
      display: block;
      width: 100%;
      opacity: 1;
      filter: saturate(150%);
    }

    .flow-div .flow-div-other {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1%;
    }


    .flow-div .showOther {
      clear: both;
      margin: 0;
      font-size: 14px;
      width: 100%;
      height: 50px;
      line-height: 50px;
      text-align: left;
      background-color: #fff;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div class="flow-div" id="ID-flow-div-manual">

    {if $data['imgStr']}
    <div class="flow-div-img">{$data['imgStr'] | raw}</div>
    {/if}
    {if $data['videoStr']}
    <div class="flow-div-video">{$data['videoStr'] | raw}</div>
    {/if}
    {if $data['textStr']}
    <div class="flow-div-other">{$data['textStr'] | raw}</div>
    {/if}
    {if $data['otherStr']}
    <div class="flow-div-other">{$data['otherStr'] | raw}</div>
    {/if}
    
  </div>

  <input type="hidden" value="{$id}" id="previewId">

  <!-- 请勿在项目正式环境中引用该 layui.js 地址 -->
  <script src="/static/layui/layui.js"></script>
  <script>
    var $ = layui.$
    function showMessageImg(obj) {
      var imgList = $('li').find('img').map(function () {
        return $(this).attr('src');
      }).get();

      var imgArray = [];
      for (var i = 0; i < imgList.length; i++) {
        imgArray.push({
          "alt": "",
          "pid": i, //图片id
          "src": imgList[i], //原图地址
          "thumb": "" //缩略图地址})
        })
      }
      // console.log(imgArray)
      // var imgUrl = $(obj).attr('src');
      var json = {
        "title": "", //相册标题
        "id": 0, //相册id
        "start": 0, //初始显示的图片序号，默认0
        "data": imgArray
      }

      if (parent.layer) {
        parent.layer.photos({
          photos: json,
          anim: 5
        });
      } else {
        layer.photos({
          photos: json,
          anim: 5
        });
      }
    }

    function showVideoPopup(obj) {
      var videoUrl = $(obj).attr('src');
      var videoHtml = '<video controls="" name="media"><source src="' + videoUrl + '" type="video/mp4"></video>';

      if (parent.layer) {
        parent.layer.open({
          type: 1,
          title: false,
          closeBtn: 1,
          area: ['auto', 'auto'],
          skin: 'layui-layer-nobg', //没有背景色
          shadeClose: true,
          content: videoHtml
        });
      } else {
        layer.open({
          type: 1,
          title: false,
          closeBtn: 1,
          area: ['auto', 'auto'],
          skin: 'layui-layer-nobg', //没有背景色
          shadeClose: true,
          content: videoHtml
        });
      }
    }

    function showTextPopup(obj) {

      if (parent.layer) {
        var layer = parent.layer
      }

      layer.open({
        type: 1,
        title: $(obj).attr('data-title'),
        shade: 0.8,
        closeBtn: 1,
        shadeClose: false,
        area: ['100%', '100%'],
        resize: false,
        maxmin: false,
        // moveOut: true,
        scrollbar: true,
        content: '<iframe sandbox="allow-same-origin allow-scripts allow-popups" src="' + $(obj).attr('data-url') + '" allowfullscreen="true" allowtransparency="true" width="100%" height="100%" frameborder="0" scrolling="yes"></iframe>'
      });
    }

    // 检查父窗口和 jQuery 是否可用
    if (parent && parent.$) {
      // 本页面onload结束后执行下面的代码
      window.onload = function () {
        var flowDivHeight = Math.max($('html').height(), $('body').height()) + 15;
        var id = $('#previewId').val();
        console.log('#iframe-sourcematerial-' + id);
        console.log(flowDivHeight)
        // 设置父窗口中指定 id 的 iframe 的高度
        parent.$('#iframe-sourcematerial-' + id).height(flowDivHeight);
        // 父集的overflow hidden
        // parent.$('#iframe-sourcematerial-' + id).parent().css('overflow', 'hidden');
      }

    }
  </script>

</body>

</html>